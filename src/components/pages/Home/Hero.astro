---
import Header from '../../UI/Header.astro';

const galleryResponse = await fetch(
  'https://evys-api-production.up.railway.app/graphql',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      query: `
      query {
        galleries (sort: "order") {
          data {
            id 
            attributes {
              image {
                data {
                  attributes {
                    url
                  }
                }
              }
            }
          }
        }
      }
    `,
    }),
  },
);

const contentResponse = await fetch(
  'https://evys-api-production.up.railway.app/graphql',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      query: `
      query {
        homePageTexts {
          data {
            attributes {
              title
              subTitle
              description
              location
            }
          }
        }
      }
    `,
    }),
  },
);

const json = await galleryResponse.json();
const data = json.data.galleries.data;

const json1 = await contentResponse.json();
const data1 = json1.data.homePageTexts.data;

const heroTexts = data1.find(
  (content: any) => content.attributes.location === 'hero',
).attributes;

const typedHeroText: { title: string; subTitle: string; description: string } =
  {
    title: heroTexts.title,
    subTitle: heroTexts.subTitle,
    description: heroTexts.description,
  };
---

<div
  class="absolute -top-[5%] -left-[15%] h-[60%] lg:h-[42.5%] w-[120%] z-0 bg-gradient-to-br from-emerald-600 via-emerald-600 to-cyan-700"
>
</div>
<div
  class="bg-grid absolute bottom-0 h-[40%] lg:bottom-6 lg:h-[60%] left-0 w-full z-0"
>
</div>
<div
  class="z-20 relative px-4 pt-[100px] md:px-8 lg:pt-[100px] flex flex-col gap-16 max-w-screen-xl mx-auto"
>
  <div class="absolute -z-10 top-1/3 -right-24 lg:top-12 lg:-left-8 opacity-70">
    <svg width={200} height={200} fill="none" viewBox="0 0 200 200">
      <defs>
        <pattern
          id="837c3e70-6c3a-44e6-8854-cc48c737b659"
          x={0}
          y={0}
          width={20}
          height={20}
          patternUnits="userSpaceOnUse"
        >
          <rect
            x={0}
            y={0}
            width={4}
            height={4}
            class="text-zinc-100"
            fill="currentColor"></rect>
        </pattern>
      </defs>
      <rect
        width={200}
        height={200}
        fill="url(#837c3e70-6c3a-44e6-8854-cc48c737b659)"></rect>
    </svg>
  </div>
  {/* Hero section */}
  <div class="lg:flex lg:gap-16 xl:justify-between">
    {/* Desktop images */}
    <article class="lg:flex flex-col hidden gap-12 flex-grow-0">
      {
        data.slice(0, 3).map((item: any) => {
          return (
            <div class="w-[260px] h-[350px] overflow-hidden rounded-tl-lg rounded-br-lg shadow-lg object-cover">
              <img
                src={item.attributes.image.data.attributes.url}
                alt="image"
                class="w-full h-full"
              />
            </div>
          );
        })
      }
    </article>
    {/* Hero header */}
    <header class="flex flex-col gap-6">
      <h1
        class="text-4xl tracking-tight text-white font-bold leading-tight sm:text-5xl sm:leading-tight lg:leading-tight xl:text-7xl xl:leading-tight"
      >
        Eesti Veterinaarmeditsiini <br class="sm:visible" /> Üliõpilaste
        <br class="sm:hidden" /> Selts
      </h1>
      <article class="hidden lg:flex items-start w-full mt-12 lg:gap-12">
        <div class="lg:flex flex-col hidden gap-12">
          {
            data.slice(3).map((item: any) => {
              return (
                <div class="w-[260px] h-[330px] overflow-hidden rounded-tl-lg rounded-br-lg shadow-lg">
                  <img
                    src={item.attributes.image.data.attributes.url}
                    alt="image"
                    class="w-full h-full object-cover"
                  />
                </div>
              );
            })
          }
        </div>
        <div class="flex flex-1 justify-center pt-48">
          <Header
            subTitle={typedHeroText.subTitle}
            header={typedHeroText.title}
            text={typedHeroText.description}
          />
        </div>
      </article>
    </header>
  </div>
  {/* Mobile images */}
  <div
    class="flex shrink-0 gap-5 justify-center mt-6 lg:hidden sm:gap-7 md:gap-9"
  >
    {
      data.map((item: any) => {
        return (
          <div class="overflow-hidden flex-none rounded-lg -rotate-2 shadow-xl w-[180px] aspect-[4/5]">
            <img
              src={item.attributes.image.data.attributes.url}
              alt="image"
              class="w-full h-full object-cover"
            />
          </div>
        );
      })
    }
  </div>
  {/* Mobile our mission section */}
  <div class="lg:hidden">
    <Header
      subTitle={typedHeroText.subTitle}
      header={typedHeroText.title}
      text={typedHeroText.description}
    />
  </div>
</div>
